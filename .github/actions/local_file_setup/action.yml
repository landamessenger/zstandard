name: Local file setup
description: Upgrades versions on dependencies and the CHANGELOG.md
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v4

    - name: Set up Node.js 18
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'

    - name: Install Landa Messenger CLI
      run: npm install @landamessenger/landa-messenger-api -g
      shell: ${{ runner.os == 'Windows' && 'cmd' || 'bash' }}

    - name: Run read-yaml action
      id: version_data
      uses: jbutcher5/read-yaml@main
      with:
        file: './zstandard_platform_interface/pubspec.yaml'
        key-path: '["version"]'

    - name: Copy CHANGELOG.md
      run: |
        if [ "${{ runner.os }}" == "Windows" ]; then
          copy CHANGELOG.md zstandard_platform_interface\CHANGELOG.md
          copy CHANGELOG.md zstandard_android\CHANGELOG.md
          copy CHANGELOG.md zstandard_ios\CHANGELOG.md
          copy CHANGELOG.md zstandard_macos\CHANGELOG.md
          copy CHANGELOG.md zstandard_windows\CHANGELOG.md
          copy CHANGELOG.md zstandard_linux\CHANGELOG.md
          copy CHANGELOG.md zstandard_web\CHANGELOG.md
          copy CHANGELOG.md zstandard_cli\CHANGELOG.md
        else
          cp CHANGELOG.md zstandard_platform_interface/CHANGELOG.md
          cp CHANGELOG.md zstandard_android/CHANGELOG.md
          cp CHANGELOG.md zstandard_ios/CHANGELOG.md
          cp CHANGELOG.md zstandard_macos/CHANGELOG.md
          cp CHANGELOG.md zstandard_windows/CHANGELOG.md
          cp CHANGELOG.md zstandard_linux/CHANGELOG.md
          cp CHANGELOG.md zstandard_web/CHANGELOG.md
          cp CHANGELOG.md zstandard_cli/CHANGELOG.md
      shell: ${{ runner.os == 'Windows' && 'cmd' || 'bash' }}

    # zstandard
    - name: Update zstandard/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false
    - name: Update zstandard/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard/pubspec.yaml'
        propertyPath: 'dependencies.zstandard_platform_interface'
        value: '^${{ steps.version_data.outputs.data }}'
        commitChange: false


    # zstandard_android
    - name: Update zstandard_android/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_android/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false
    - name: Update zstandard_android/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_android/pubspec.yaml'
        propertyPath: 'dependencies.zstandard_platform_interface'
        value: '^${{ steps.version_data.outputs.data }}'
        commitChange: false


    # zstandard_ios
    - name: Update zstandard_ios/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_ios/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false
    - name: Update zstandard_ios/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_ios/pubspec.yaml'
        propertyPath: 'dependencies.zstandard_platform_interface'
        value: '^${{ steps.version_data.outputs.data }}'
        commitChange: false


    # zstandard_macos
    - name: Update zstandard_macos/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_macos/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false
    - name: Update zstandard_macos/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_macos/pubspec.yaml'
        propertyPath: 'dependencies.zstandard_platform_interface'
        value: '^${{ steps.version_data.outputs.data }}'
        commitChange: false

    # zstandard_linux
    - name: Update zstandard_linux/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_linux/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false
    - name: Update zstandard_linux/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_linux/pubspec.yaml'
        propertyPath: 'dependencies.zstandard_platform_interface'
        value: '^${{ steps.version_data.outputs.data }}'
        commitChange: false


    # zstandard_windows
    - name: Update zstandard_windows/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_windows/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false
    - name: Update zstandard_windows/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_windows/pubspec.yaml'
        propertyPath: 'dependencies.zstandard_platform_interface'
        value: '^${{ steps.version_data.outputs.data }}'
        commitChange: false


    # zstandard_web
    - name: Update zstandard_web/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_web/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false
    - name: Update zstandard_web/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_web/pubspec.yaml'
        propertyPath: 'dependencies.zstandard_platform_interface'
        value: '^${{ steps.version_data.outputs.data }}'
        commitChange: false

    # zstandard_cli
    - name: Update zstandard_cli/pubspec.yaml
      uses: fjogeleit/yaml-update-action@main
      with:
        valueFile: 'zstandard_cli/pubspec.yaml'
        propertyPath: 'version'
        value: '${{ steps.version_data.outputs.data }}'
        commitChange: false

